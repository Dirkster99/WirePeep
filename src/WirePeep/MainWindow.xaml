<m:ExtendedWindow x:Class="WirePeep.MainWindow"
		xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:m="http://menees.com/xaml"
		xmlns:local="clr-namespace:WirePeep"
		mc:Ignorable="d"
		Title="WirePeep - Network Downtime Monitor" Height="450" Width="800">

	<Window.CommandBindings>
		<CommandBinding Command="local:Commands.AddLocation" Executed="AddLocationExecuted" />
		<CommandBinding Command="local:Commands.Exit" Executed="ExitExecuted" />
		<CommandBinding Command="local:Commands.ExportLog" Executed="ExportLogExecuted" />
		<CommandBinding Command="local:Commands.ViewOptions" Executed="ViewOptionsExecuted" />
		<CommandBinding Command="Help" Executed="HelpExecuted" />
		<CommandBinding Command="local:Commands.About" Executed="AboutExecuted" />
	</Window.CommandBindings>

	<Window.Resources>
		<local:StatusRowCollection x:Key="StatusRows"/>

		<CollectionViewSource x:Key="StatusRowsView" Source="{StaticResource StatusRows}">
			<CollectionViewSource.GroupDescriptions>
				<PropertyGroupDescription PropertyName="GroupName"/>
			</CollectionViewSource.GroupDescriptions>
		</CollectionViewSource>

		<Style x:Key="StatusGroupHeaderStyle" TargetType="{x:Type GroupItem}">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type GroupItem}">
						<Expander x:Name="exp" IsExpanded="True"
								  Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}">
							<Expander.Header>
								<DockPanel>
									<!-- The DataContext here is a CollectionViewGroup (based on the PropertyGroupDescription.) -->
									<CheckBox IsChecked="{Binding Items[0].IsGroupAccessible}" IsEnabled="False"/>
									<TextBlock Text="{Binding Name}" FontWeight="Bold"/>
									<TextBlock Text="  —  Poll every "/>
									<TextBlock Text="{Binding Items[0].GroupPollSeconds}"/>
									<TextBlock Text="s.  Wait "/>
									<TextBlock Text="{Binding Items[0].GroupWaitMilliseconds}"/>
									<TextBlock Text="ms.  Fail after "/>
									<TextBlock Text="{Binding Items[0].GroupFailSeconds}"/>
									<TextBlock Text="s outage."/>
								</DockPanel>
							</Expander.Header>
							<ItemsPresenter />
						</Expander>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style TargetType="{x:Type TextBlock}" x:Key="RightAlignCell">
			<Setter Property="HorizontalAlignment" Value="Stretch"/>
			<Setter Property="TextAlignment" Value="Right"/>
		</Style>
	</Window.Resources>

	<Grid x:Name="windowLayoutGrid">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition MinHeight="25"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition MinHeight="25"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>

		<Menu Grid.Row="0" Padding="2">
			<MenuItem Header="_View">
				<MenuItem Header="_Add Location..." Command="local:Commands.AddLocation"/>
				<MenuItem Header="_Export Log..." Command="local:Commands.ExportLog"/>
				<Separator/>
				<MenuItem Header="_Options..." Command="local:Commands.ViewOptions"/>
				<Separator/>
				<MenuItem Header="E_xit" Command="local:Commands.Exit"/>
			</MenuItem>
			<MenuItem Header="_Help">
				<MenuItem Header="_WirePeep.com" Command="Help"/>
				<MenuItem Header="_About..." Command="local:Commands.About"/>
			</MenuItem>
		</Menu>

		<DataGrid x:Name="statusGrid" ItemsSource="{Binding Source={StaticResource StatusRowsView}}"
				  IsReadOnly="True" Grid.Row="1" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" CanUserReorderColumns="False" CanUserSortColumns="False" GridLinesVisibility="None" AutoGenerateColumns="False" CanUserResizeRows="False" HeadersVisibility="Column">
			<DataGrid.GroupStyle>
				<GroupStyle ContainerStyle="{StaticResource StatusGroupHeaderStyle}">
					<GroupStyle.Panel>
						<ItemsPanelTemplate>
							<DataGridRowsPresenter/>
						</ItemsPanelTemplate>
					</GroupStyle.Panel>
				</GroupStyle>
			</DataGrid.GroupStyle>

			<DataGrid.Columns>
				<DataGridTextColumn Header="Name" Binding="{Binding LocationName}"/>
				<DataGridTextColumn Header="IP Address" Binding="{Binding LocationAddress}"/>
				<DataGridCheckBoxColumn Header="Status" Binding="{Binding IsLocationConnected}"/>
				<DataGridCheckBoxColumn Header="Current" Binding="{Binding IsLocationUpToDate}"/>
				<DataGridTextColumn Header="Response (ms)" Binding="{Binding LocationRoundtripMilliseconds}" ElementStyle="{StaticResource RightAlignCell}"/>
			</DataGrid.Columns>
        </DataGrid>

		<GridSplitter x:Name="splitter" Grid.Row="2" HorizontalAlignment="Stretch" VerticalAlignment="Center" ShowsPreview="True" Height="4" />

		<DataGrid x:Name="logGrid" IsReadOnly="True" Grid.Row="3" Background="{DynamicResource {x:Static SystemColors.WindowBrushKey}}" CanUserSortColumns="False" CanUserReorderColumns="False" GridLinesVisibility="None" AutoGenerateColumns="False" CanUserResizeRows="False" HeadersVisibility="Column">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Peer Group"/>
				<DataGridTextColumn Header="Start"/>
				<DataGridTextColumn Header="Length"/>
				<DataGridTextColumn Header="End"/>
				<DataGridTextColumn Header="Since Previous"/>
				<DataGridTextColumn Header="Comment"/>
			</DataGrid.Columns>
        </DataGrid>

		<StatusBar Grid.Row="4">
			<StatusBarItem>
				<TextBlock>Monitored time:</TextBlock>
			</StatusBarItem>
			<StatusBarItem>
				<TextBlock x:Name="monitoredTime">0:00:00</TextBlock>
			</StatusBarItem>
			<Separator/>
			<StatusBarItem>
				<TextBlock>Failure count:</TextBlock>
			</StatusBarItem>
			<StatusBarItem>
				<TextBlock x:Name="failureCount">0</TextBlock>
			</StatusBarItem>
		</StatusBar>
	</Grid>
</m:ExtendedWindow>
